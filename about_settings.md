
# 3. 詳細設定

[English](./en_about_settings.html)

コントロールパネルの`ホーム`タブで、`設定ウィンドウを開く`ボタンを押すと設定ウィンドウが開けます。

[![Setting Window](./images/about_settings/img01_010_setting_window.png)](./images/about_settings/img01_010_setting_window.png){: data-lightbox="img01_010"}

設定ウィンドウでは、コントロールパネルに表示していない調整用の機能をサポートしています。

* 3.1. `ウィンドウ`
    - キャラクター表示ウィンドウの制御
* 3.2. `モーション`
    - キャラクターの体型や動き方にあわせた調整
* 3.3. `レイアウト`
    - カメラ、キーボード、タッチパッド、ゲームパッドの配置
* 3.4. `エフェクト` (※v0.9.2以前では`ライト`タブという名称です)
    - ライト、影、Bloom、風の調整
* 3.5. `Word to Motion`
    - タイピングで表情やモーションを切り替える機能の設定

## 3.1. ウィンドウ

`ウィンドウ`タブではキャラクター表示ウィンドウの背景が不透明なときの背景色や、最前面表示のオン・オフが切り替えられます。

`キャラ透明化の詳細`では、キャラクターを半透明化する条件を指定できます。デフォルトではキャラクター上にマウスポインターが乗ったとき半透明化します。これは、キャラ背後に何があるか見やすくするためです。`キャラの透明化レベル`を変更すれば透明化の基準を変更できます。v0.8.5以前と同じ挙動にしたい場合、レベル0の「つねに不透明」を用います。


また、Windowsのディスプレイ設定でスクリーンの解像度や配置を変更してキャラクターを見失ってしまった場合、`キャラクター位置のリセット`ボタンで復帰できることがあります。詳細は[4: トラブルシューティング](./troubleshooting.html)を参照下さい。

※v0.8.1ででは`ウィンドウ`の項目でキャラクターの表示位置を固定するためのメニューがありましたが、v0.8.1以降ではこの機能を廃止し、代わりに前回の表示位置をつねに保存するようになっています。

## 3.2. モーション

`モーション`タブではキャラクターの動き方や体型にかんする調整ができます。

[![Motion Tab](./images/about_settings/img01_018_motion_tab.png)](./images/about_settings/img01_018_motion_tab.png){: data-lightbox="img01_018"}

### 3.2.1. 顔・表情

上部の項目はコントロールパネルの`配信`タブで`顔・表情`に表示されているのとほぼ同じですが、詳細な設定が可能です。

`顔トラッキング中も自動でまばたき`チェックをオフにすると、画像処理ベースで目の開閉を制御するようになります。

またv0.9.6以降では`顔トラッキング中の前後移動を有効化`チェックをオンにすることで、キャラクターが前後に動くようになります。手元のPC環境で顔トラッキングが安定している場合はこのチェックをオンにしますが、キャラクターがガクガクしてしまう場合はオフに戻します。


下部の`Funブレンドのデフォルト値[%]`は、キャラクターの表情をつねにやや笑顔に保つための設定値です。

大きくするほど基本の表情が笑顔になりますが、キャラクターによってはまばたきやリップシンクの動作と組み合わせたとき不自然になるため、その場合は小さな値にします。

その下の`眉毛(開いてカスタマイズ)`は、通常開く必要のない高度な機能です。独自に作成したVRMで眉毛をうまく動かしたい場合や、眉毛の動きが大きすぎたり、小さすぎたりする場合にカスタマイズします。

※ここをカスタマイズするにはVRMの表情を操作する「ブレンドシェイプ」の知識が必要です。もし詳しくない場合、[バーチャルキャストWikiの説明](https://virtualcast.jp/wiki/doku.php?id=%E3%83%A2%E3%83%87%E3%83%AB%E4%BD%9C%E6%88%90:%E3%83%96%E3%83%AC%E3%83%B3%E3%83%89%E3%82%B7%E3%82%A7%E3%82%A4%E3%83%97%E8%A8%AD%E5%AE%9A)に記載の`ブレンドシェイプの値設定`などをご覧下さい。

* `左眉上げ`: 左眉、あるいは両方の眉を上げるブレンドシェイプを指定します。
* `左眉下げ`: 左眉、あるいは両方の眉を下げるブレンドシェイプを指定します。
* 左右で別々のキーを使う: 右と左の眉が別々に動かせるモデルの場合、チェックをオンにします。
* `右眉上げ`: 右眉を上げるブレンドシェイプを指定します。
* `右眉下げ`: 右眉を下げるブレンドシェイプを指定します。
* `眉上げスケール [%]`と`眉下げスケール [%]`: 眉の上下の動きの大きさです。誇張したい場合は大きめの値を、大きくしすぎると不自然になる場合は小さめの値を指定します。



### 3.2.2. 腕・ひじ

腕やひじの動かし方を設定します。

`タイピング/マウス動作を反映`チェックをオフにすると、タイピングやマウス、ゲームパッドの動作を行わなくなります。キャラクターを完全に棒立ちさせたい場合、このチェックをオフにします。

`脇をしめる幅 [cm]`と`脇をしめる強さ [%]`は、キャラクターが脇をしめたまま動くためのパラメータです。

`脇をしめる幅 [cm]`は、キャラクターの腰が太い場合は大きくし、細い場合は小さくします。

`脇をしめる強さ [%]`は、脇をしっかりしめてほしい場合、大きくします。大きすぎる値を指定すると、腕が体にめり込みやすくなることに注意してください。

以下は、デフォルトの設定、脇をきつくしめる設定、脇を開いた設定の例です。

[![Arm Side Default](./images/about_settings/img01_020_arm_side_default.png)](./images/about_settings/img01_020_arm_side_default.png){: data-lightbox="img01_020"}

[![Arm Side Close](./images/about_settings/img01_030_arm_side_close.png)](./images/about_settings/img01_030_arm_side_close.png){: data-lightbox="img01_030"}

[![Arm Side Open](./images/about_settings/img01_040_arm_side_open.png)](./images/about_settings/img01_040_arm_side_open.png){: data-lightbox="img01_040"}

`補助ポインターを表示`では、`プレゼン風に右手を動かす`のチェックがオンのときにマウスポインターを強調するかどうかを設定します。

`プレゼン動作サイズ[%]`は、`プレゼン風に右手を動かす`のチェックがオンのときの指さし動作の大きさを指定します。

モニターサイズに比べてキャラクターが小さい場合、この値を小さくすることで、腕が伸びっぱなしになるのを防ぎます。

逆に、モニターに対してキャラクターが大きかったり、キャラの手元を指し示したいときは、この値を大きくします。

`プレゼン動作の最小半径[cm]`は、指さし動作中に右手が胴体にめり込まないためのパラメータです。

大きな値にすると手が体にめり込みにくくなりますが、手元を指しにくくなり、腕が伸びがちになります。


### 3.2.3. 手・指

手や指の長さと、打鍵動作の大きさを調整します。

タイピング中の手の位置が大きくずれてしまう場合や、手がキーボードから浮きすぎる場合、調整してみてください。

**Hint:** 自然な動きに調整したのち、わざと`(打鍵後)手の高さ調整[cm]`の値だけを大きくすることで、大げさにタイピング動作するようにできます。

[![Large Typing Motion](./images/about_settings/img01_045_large_type_motion.png)](./images/about_settings/img01_045_large_type_motion.png){: data-lightbox="img01_045"}


### 3.2.4. 待機モーション

待機モーションは呼吸動作に相当する動きです。

キャラクターによっては、動きを極端に大きくすると浮いて見えるかもしれません。


## 3.3. レイアウト

`レイアウト`タブではカメラ、キーボード、ゲームパッドなどの配置を調整できます。

[![Layout Tab](./images/about_settings/img01_050_layout_tab.png)](./images/about_settings/img01_050_layout_tab.png){: data-lightbox="img01_050"}

### 3.3.1. カメラ

コントロールパネルの`配信`タブにある`カメラ`とほぼ同じ機能ですが、ここで視野角を設定することもできます。

### 3.3.2. デバイスのレイアウト

v0.9.5以降で追加されています。

コントロールパネルの「配信」にある「デバイスのレイアウト」と同じ機能です。

### 3.3.3. キーボード / MIDI

キーボードの表示、およびタイピング時のエフェクトを調整できます。

また、v0.9.4以前のバージョンをお使いの場合、ここでキャラクターの体格に応じてサイズを調整できます。

v0.9.6以降ではMIDIコントローラの設定が追加されています。VMagicMirrorのMIDI入力は表情の切り替え機能のために使用されます。

DAWソフトなどでMIDI入力を用いる場合や、手元にMIDIコントローラが無い場合は、`MIDIコントローラをVMagicMirrorで使用`のチェックをオフにします。

### 3.3.4. ゲームパッド

v0.9.4またはそれ以前のバージョンの場合は、ゲームパッドの高さや大きさをここで調整します。

また、ゲームパッドのスティックを傾けるとキャラクターも傾きます。動作を確認する場合、デフォルト設定のまま左スティックを動かしてみて下さい。

* `キャラ傾き入力`でキャラクターが傾くスティックの種類を変更できます。
* `傾く方向を反転`のチェックをオンにすると、スティック入力と逆方向にキャラクターが傾きます。

なお、デフォルトではゲームパッドのキャプチャが有効ですが、ゲームパッドを使わない場合で、かつVMagicMirrorのCPU消費を少しでも抑えたい場合は`ゲームパッド入力のキャプチャを有効化`をオフにします。


## 3.4. エフェクト

`エフェクト`タブでは光、影、Bloom、風の設定を調節できます。

キャラクターに照明を当てるライトと影の向きは別々の設定になっています。

これは、キャラクターには上から光を当て、影は正面から当てるための仕組みです。

影の向きと奥行を調節すると、キャラクターとデスクトップ画面の距離感を変更することもできます。

デフォルト設定の影:

[![Default Depth Shadow](./images/about_settings/img01_070_shadow_depth_default.png)](./images/about_settings/img01_070_shadow_depth_default.png){: data-lightbox="img01_070"}

キャラと画面が離れているように見せるための調整例: 

[![Default Depth Shadow](./images/about_settings/img01_080_shadow_depth_look_far.png)](./images/about_settings/img01_080_shadow_depth_look_far.png){: data-lightbox="img01_080"}

ライトおよび影については、VRMで`Unlit`系統のシェーダーを使っていると機能しないことに注意してください。

また、`風`の設定については以下にも注意して下さい。

* `VRMSpringBone`をセットアップしてある場合にのみ動作します。
* 風機能ではキャラクターに設定された全ての`VRMSpringBone`が影響を受けます。髪だけを揺らしてスカートは揺らさない、といった設定はサポートしていません。

## 3.5. Word to Motion

`Word to Motion`はv0.9.0で追加された機能で、単語をタイピングするとキャラクターの表情が切り替えられたり、簡易的なモーションを再生できたりする機能です。

[![Word to Motion Tab](./images/about_settings/img01_100_word_to_motion_tab.png)](./images/about_settings/img01_100_word_to_motion_tab.png){: data-lightbox="img01_100"}

使い方によってはこの機能がかえって不自然になる事もあります。その場合、`Word to Motionを有効化`チェックをオフにします。

`Word to Motion`機能では、何の単語に、どのように反応するかをアイテムとして定義します。

各アイテムの左にある再生ボタンを押すか、または単語をタイピングすることで、それぞれのアイテムの動きを確認できます。上のスクリーンショットの例では"joy"とタイピングした直後の様子を示しています。

**NOTE:** `Word to Motion`機能でキャラを動かすとき、単語のタイピング中で制御キー(Shift, Ctrl, Altなど)を押さないように注意してください。また、タイピングが極端に遅い場合、単語として認識されない事があります。

VMagicMirror v0.9.1以降ではゲームコントローラを使ってモーションや表情を実行できます。`ゲームパッドのボタンで表情/モーションを実行`チェックをオンにして、左の列に書かれたボタンを押すと、モーションが実行できます。

[![Word to Motion by Gamepad](./images/about_settings/img01_105_word_to_motion_by_gamepad.png)](./images/about_settings/img01_105_word_to_motion_by_gamepad.png){: data-lightbox="img01_105"}

この例ではコントローラの`Y`キーを押して、`fun`の表情を実行しています。

**NOTE:** `ゲームパッドのボタンで表情/モーションを実行`チェックをオンにすると、ゲームコントローラを握る動きは無効化されます。コントローラを使ったゲーム配信をする場合、この機能はオフにした方が良いかもしれません。


`上`ボタンや`下`ボタンでアイテムをソートできます。また、アイテムの右にある`削除`ボタンを押すと作成したアイテムを削除できます。

アイテムをカスタマイズするには以下の4ステップを行います。

* Step 1: `+`ボタンを押してアイテムを追加します。既に存在するアイテムを編集する場合、このステップは不要です。
* Step 2: 設定ボタンを押し、アイテムのカスタムウィンドウを開きます。
* Step 3: カスタムウィンドウ上でモーションや表情を設定します。
* Step 4: `OK`を押して変更を反映します。

[![Word to Motion Custom](./images/about_settings/img01_110_word_to_motion_custom_flow.png)](./images/about_settings/img01_110_word_to_motion_custom_flow.png){: data-lightbox="img01_110"}

カスタムウィンドウで出来る主な操作は以下の4つです。

[![Word to Motion Custom Window](./images/about_settings/img01_120_word_to_motion_custom_window.png)](./images/about_settings/img01_120_word_to_motion_custom_window.png){: data-lightbox="img01_120"}

* 1: このアイテムを起動するワードを指定します。
* 2: モーションを選びます。
    * **NOTE:** v0.9.0では2種類のビルトインモーションのみをサポートしています。そのため、基本的には`なし`を選ぶ事になります。
* 3: 表情の基本設定です。
    * `表情の動作を有効化`をオンにすることで、このアイテムで表情を動かせるようになります。
    * `(全身モーションが「なし」の場合) 表情の変化時間 [sec]`では、表情をキープする時間を設定できます。
    * `アニメーション終了後も表情を維持`をオンにすると、表情を切り替えたままにできます。
* 4: ブレンドシェイプの設定です。
    * **NOTE:** 見た目をよくするため、基本的には1つのブレンドシェイプのみを大きな値にします。

v0.9.6以降ではMIDIコントローラでも表情が切り替えられます。

MIDIコントローラのキーと表情を関連づけるために3つのステップが必要です。

https://twitter.com/baku_dreameater/status/1211990346525077504

* `デバイスの割り当て`を`MIDIコントローラ`にした状態で`キー割り当て`右の編集ボタンをクリックします。
* `MIDIのノート割り当て`ウィンドウが現れるので、この状態で使用したいMIDIキーを9個、順番に押します。押したキーの番号は`変更後のノート`に記録されます。
* 設定が完了したら`OK`をクリックしてウィンドウを閉じます。

ウィンドウを閉じたのち、設定したMIDIキーを押してみて、表情が変わることを確認します。


**ヒント:**

`アニメーション終了後も表情を維持`をオンにしたアイテムで表情を切り替える場合、表情をリセットする機能が必要になるはずです。

以下のような設定のアイテムを作ることで、表情をリセットできます。このアイテムは既定の設定で、`reset`という名称で含まれています。

[![How to Reset Keep Face](./images/about_settings/img01_130_word_to_motion_reset_tips.png)](./images/about_settings/img01_130_word_to_motion_reset_tips.png){: data-lightbox="img01_130"}

## 3.6. 設定のリセットについて

v0.9.2以降では、設定をカテゴリ別にリセットすることができます。リセットをするには、詳細設定ウィンドウの各項目の上部にあるリセットボタンをクリックします。

以下の例では、ライトの設定を初期状態にリセットしています。

[![Reset Setting 1](./images/about_settings/img01_140_reset_setting_before.png)](./images/about_settings/img01_140_reset_setting_before.png){: data-lightbox="img01_140"}

[![Reset Setting 2](./images/about_settings/img01_150_reset_setting_before.png)](./images/about_settings/img01_150_reset_setting_after.png){: data-lightbox="img01_150"}



## Sections

* [1: VMagicMirrorについて](./index.html)
* [2: 基本的な使い方](./get_started.html)
* 3: 詳細設定 (このページ)
* [4: トラブルシューティング](./troubleshooting.html)
* [Tips A: デスクトップマスコット化のための設定](./tips_desktop_mascot.html)
* [Tips B: プレゼンテーションでVMagicMirrorを使う](./tips_presentation.html)
* [Tips C: 前バージョン(v0.8.0以降)の設定を引き継ぐ](./tips_load_prev_setting.html)
* [Tips D: キーボードやタッチパッドの見た目を変更する](./tips_change_textures.html)
* [License](./about_license.html)
* [Change Log](./changelog.html)
* [FAQ](./en_frequently_asked_questions.html)
